HW2
================
Eric Xu
2025-09-23

to store the local data files, and use relative paths to access these
data files `"./Data/"`

## Problem 1

Data cleaning from csv files `snp` and `pol_month`, tidy and transpose
the `unemployment` file

``` r
pol_month = read_csv("./Data/pols-month.csv") |> 
  janitor::clean_names() |> 
  separate(mon,sep = "-",
           into = c("year","month","day")) |> 
  mutate(
    year = as.integer(year),
    day = as.integer(day),
    month = as.integer(month),
    month = month.abb[month],
    president = case_when(prez_gop != 0 ~ "gop",
                          prez_dem != 0 ~ "dem")
    ) |> 
  select(-prez_gop, 
         -prez_dem, 
         -day
         )
snp = read_csv("./Data/snp.csv") |> 
  janitor::clean_names() |> 
  separate(date,
           sep = "/",
           into = c("month","day","year")) |> 
  mutate(
    year = as.integer(year),
    day = as.integer(day),
    month_num = as.integer(month),
    month = month.abb[month_num],
    year = case_when(
      year < 50 ~ 2000L + year,
      year >= 50 ~ 1900L + year
      )
    ) |> 
  select(year,month,everything()) |> 
  arrange(year,month_num)|> 
  select(-day,
         -month_num
         )

unemployment = read_csv("./Data/unemployment.csv") |> 
  pivot_longer(
    Jan:Dec,
    values_to = "unemployment_rate",
    names_to = "month" 
    ) |> 
  rename(
    year = Year
  )
```

merge data with the same year and month variable:

``` r
joint = full_join(pol_month,snp, by = c("year","month")) |> 
  full_join(unemployment, by = c("year","month"))
```

**Descriptive data of `joint`:**

``` r
skimr::skim(joint)
```

|                                                  |       |
|:-------------------------------------------------|:------|
| Name                                             | joint |
| Number of rows                                   | 828   |
| Number of columns                                | 11    |
| \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_   |       |
| Column type frequency:                           |       |
| character                                        | 2     |
| numeric                                          | 9     |
| \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_ |       |
| Group variables                                  | None  |

Data summary

**Variable type: character**

| skim_variable | n_missing | complete_rate | min | max | empty | n_unique | whitespace |
|:--------------|----------:|--------------:|----:|----:|------:|---------:|-----------:|
| month         |         0 |          1.00 |   3 |   3 |     0 |       12 |          0 |
| president     |         6 |          0.99 |   3 |   3 |     0 |        2 |          0 |

**Variable type: numeric**

| skim_variable | n_missing | complete_rate | mean | sd | p0 | p25 | p50 | p75 | p100 | hist |
|:---|---:|---:|---:|---:|---:|---:|---:|---:|---:|:---|
| year | 0 | 1.00 | 1981.00 | 19.93 | 1947.00 | 1964.00 | 1981.00 | 1998.0 | 2015.00 | ▇▇▇▇▇ |
| gov_gop | 6 | 0.99 | 22.48 | 5.68 | 12.00 | 18.00 | 22.00 | 28.0 | 34.00 | ▆▆▇▅▅ |
| sen_gop | 6 | 0.99 | 46.10 | 6.38 | 32.00 | 42.00 | 46.00 | 51.0 | 56.00 | ▃▃▇▇▇ |
| rep_gop | 6 | 0.99 | 194.92 | 29.24 | 141.00 | 176.00 | 195.00 | 222.0 | 253.00 | ▃▇▆▃▅ |
| gov_dem | 6 | 0.99 | 27.20 | 5.94 | 17.00 | 22.00 | 28.00 | 32.0 | 41.00 | ▆▅▇▆▂ |
| sen_dem | 6 | 0.99 | 54.41 | 7.37 | 44.00 | 48.00 | 53.00 | 58.0 | 71.00 | ▇▆▇▃▂ |
| rep_dem | 6 | 0.99 | 244.97 | 31.37 | 188.00 | 211.00 | 250.00 | 268.0 | 301.00 | ▇▂▇▇▅ |
| close | 41 | 0.95 | 474.89 | 545.96 | 17.05 | 83.74 | 138.53 | 941.8 | 2107.39 | ▇▁▂▁▁ |
| unemployment_rate | 18 | 0.98 | 5.83 | 1.65 | 2.50 | 4.70 | 5.60 | 6.9 | 10.80 | ▃▇▅▂▁ |

``` r
names(joint)
```

    ##  [1] "year"              "month"             "gov_gop"          
    ##  [4] "sen_gop"           "rep_gop"           "gov_dem"          
    ##  [7] "sen_dem"           "rep_dem"           "president"        
    ## [10] "close"             "unemployment_rate"

``` r
joint |> 
  ggplot(aes(x = year, y = unemployment_rate, color = president)) +
  geom_point(na.rm = TRUE) +
  labs(
    title = "Average Monthly Unemployment Rate Over Time",
    y = "Unemployment Rate (%)",
    x = "Year"
  ) +
  scale_x_continuous(n.breaks = 10)+
  theme(
    plot.title = element_text(hjust = 0.5, size = 18),
    axis.title = element_text(size = 14, ),
    axis.text = element_text(size = 12)
    )
```

![](p8105_hw2_sx2402_files/figure-gfm/plot%20and%20descriptive%20data-1.png)<!-- -->

``` r
joint |> 
  ggplot(aes(x = year, y = close, color = president)) +
  geom_point(na.rm = TRUE) +
  labs(
    title = "S&P Closing Value over Time",
    x = "Year",
    y = "closing Values S&P"
  ) +  
  scale_x_continuous(n.breaks = 10)+
  theme(
    plot.title = element_text(hjust = 0.5, size = 18),
    axis.title = element_text(size = 14, ),
    axis.text = element_text(size = 12)
    )
```

![](p8105_hw2_sx2402_files/figure-gfm/plot%20and%20descriptive%20data-2.png)<!-- -->

The dataset `joint` combines information from `pols-month`, `snp`, and
`unemployment`. The original files tracked the partisan composition of
U.S. politics from 1947 to 2015, along with an indicator for the sitting
president. The `snp` file contained monthly closing values of the S&P
500 stock index from 1950 to 2015, the mean value is 474.8887404, with a
standard deviation of 545.9569797. while the unemployment file provided
national unemployment rates is 1948 to 2015 by month. After cleaning and
aligning by year and month, the merged dataset `joint` has 828 rows and
11 columns, covering the period 1947 to 2015. On average, unemployment
was 5.83%, S&P closing values ranged within 17.049999 and 2107.389893.
The overall diagram shows an increasing trend of unemployment rate and
S&P closing value. The colored president political party demonstrated a
fluctuation of closing value after 2000 and spiking of unemployment rate
after 1980 when president is GOP. This data only shows association by
time and president political party, and the association is not examined
by other covariates.

## Problem 2

``` r
mr_trash_wheel = readxl::read_excel("./Data/202409 Trash Wheel Collection Data.xlsx",sheet = "Mr. Trash Wheel", range = "A2:N653")|>
  janitor::clean_names() |> 
  filter(!is.na(dumpster)) |> 
  mutate(
    sports_balls = as.integer(round(sports_balls)),
    trash_wheel = "Mr",
    year = as.integer(year)
    )

prof_trash_wheel = readxl::read_excel("./Data/202409 Trash Wheel Collection Data.xlsx",sheet = "Professor Trash Wheel", range = "A2:M120")|>
  janitor::clean_names() |> 
  filter(!is.na(dumpster)) |>
  mutate(
    trash_wheel = "Professor",
    year = as.integer(year)
    )

gwyn_trash_wheel =  readxl::read_excel("./Data/202409 Trash Wheel Collection Data.xlsx",sheet = "Gwynnda Trash Wheel", range = "A2:L265")|>
  janitor::clean_names() |> 
  filter(!is.na(dumpster)) |>
  mutate(
    trash_wheel = "Gwynnda",
    year = as.integer(year)
    )


all_wheel = bind_rows(mr_trash_wheel,prof_trash_wheel,gwyn_trash_wheel)

skimr::skim(all_wheel)
```

|                                                  |           |
|:-------------------------------------------------|:----------|
| Name                                             | all_wheel |
| Number of rows                                   | 1032      |
| Number of columns                                | 15        |
| \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_   |           |
| Column type frequency:                           |           |
| character                                        | 2         |
| numeric                                          | 12        |
| POSIXct                                          | 1         |
| \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_ |           |
| Group variables                                  | None      |

Data summary

**Variable type: character**

| skim_variable | n_missing | complete_rate | min | max | empty | n_unique | whitespace |
|:--------------|----------:|--------------:|----:|----:|------:|---------:|-----------:|
| month         |         0 |             1 |   3 |   9 |     0 |       14 |          0 |
| trash_wheel   |         0 |             1 |   2 |   9 |     0 |        3 |          0 |

**Variable type: numeric**

| skim_variable | n_missing | complete_rate | mean | sd | p0 | p25 | p50 | p75 | p100 | hist |
|:---|---:|---:|---:|---:|---:|---:|---:|---:|---:|:---|
| dumpster | 0 | 1.00 | 245.85 | 187.85 | 1.00 | 86.00 | 199.00 | 393.25 | 651.00 | ▇▆▃▃▃ |
| year | 0 | 1.00 | 2019.84 | 2.90 | 2014.00 | 2018.00 | 2020.00 | 2022.00 | 2024.00 | ▅▆▅▇▆ |
| weight_tons | 0 | 1.00 | 3.04 | 0.79 | 0.61 | 2.54 | 3.08 | 3.55 | 5.62 | ▁▃▇▃▁ |
| volume_cubic_yards | 0 | 1.00 | 15.08 | 1.29 | 5.00 | 15.00 | 15.00 | 15.00 | 20.00 | ▁▁▁▇▁ |
| plastic_bottles | 1 | 1.00 | 2201.31 | 1634.80 | 0.00 | 980.00 | 1900.00 | 2900.00 | 9830.00 | ▇▆▁▁▁ |
| polystyrene | 1 | 1.00 | 1383.05 | 1813.67 | 0.00 | 230.00 | 640.00 | 2045.00 | 11528.00 | ▇▂▁▁▁ |
| cigarette_butts | 1 | 1.00 | 13295.92 | 23690.78 | 0.00 | 2800.00 | 4800.00 | 12000.00 | 310000.00 | ▇▁▁▁▁ |
| glass_bottles | 264 | 0.74 | 20.92 | 15.08 | 0.00 | 10.00 | 18.00 | 28.00 | 110.00 | ▇▃▁▁▁ |
| plastic_bags | 1 | 1.00 | 927.03 | 1388.81 | 0.00 | 220.00 | 470.00 | 1115.00 | 13450.00 | ▇▁▁▁▁ |
| wrappers | 118 | 0.89 | 2246.28 | 2638.16 | 0.00 | 900.00 | 1440.00 | 2580.00 | 20100.00 | ▇▁▁▁▁ |
| sports_balls | 381 | 0.63 | 13.98 | 9.96 | 0.00 | 6.00 | 12.00 | 20.00 | 56.00 | ▇▆▂▁▁ |
| homes_powered | 69 | 0.93 | 46.54 | 17.89 | 0.00 | 39.00 | 49.83 | 58.08 | 93.67 | ▂▂▇▅▁ |

**Variable type: POSIXct**

| skim_variable | n_missing | complete_rate | min | max | median | n_unique |
|:---|---:|---:|:---|:---|:---|---:|
| date | 0 | 1 | 2014-05-16 | 2024-06-11 | 2020-12-26 | 540 |

The combined Trash Wheel dataset contains 1032 dumpster-level
observations across Mr., Professor, and Gwynnda Trash Wheels. Variables
include dumpster, month, year, date, weight_tons, volume_cubic_yards,
plastic_bottles, polystyrene, cigarette_butts, glass_bottles,
plastic_bags, wrappers, sports_balls, homes_powered, trash_wheel, and
item-specific counts such as `cigarette_butts`, `plastic_bottles`, and
`sports_balls`. The variable `weight_tons` measures the amount of trash
collected per dumpster, while `sports_balls` counts the number of balls
collected at time, rounded to the nearest integer. Professor Trash Wheel
has collected a total of 246.74 tons of trash, while Gwynnda collected
18120 cigarette butts in June 2022.

## Problem 3

``` r
zip_code = read_csv("./Data/Zip Codes.csv") |> 
  janitor::clean_names() |> 
  select(zip_code,everything(),-file_date,-county_code,-county_fips,-state_fips)
```

    ## Rows: 322 Columns: 7
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (4): County, County Code, File Date, Neighborhood
    ## dbl (3): State FIPS, County FIPS, ZipCode
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
zori = read.csv("./Data/Zip_zori_uc_sfrcondomfr_sm_month_NYC.csv") |> 
  janitor::clean_names() |> 
  filter(region_type == "zip")|> 
  rename(
    zip_code = region_name,
    zori_county = county_name
         ) |> 
  select(zip_code,everything(),-region_type,-metro,-city,-state,-state_name,-region_id)

zori_long = zori |> 
  pivot_longer(x2015_01_31:x2024_08_31,
               names_to = "date",
               values_to = "zori",
               names_prefix = "x",
               )

zori_zip = inner_join(zori_long,zip_code,by="zip_code",relationship = "many-to-many")
```

``` r
skimr::skim(zori_zip)
```

|                                                  |          |
|:-------------------------------------------------|:---------|
| Name                                             | zori_zip |
| Number of rows                                   | 17516    |
| Number of columns                                | 7        |
| \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_   |          |
| Column type frequency:                           |          |
| character                                        | 4        |
| numeric                                          | 3        |
| \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_ |          |
| Group variables                                  | None     |

Data summary

**Variable type: character**

| skim_variable | n_missing | complete_rate | min | max | empty | n_unique | whitespace |
|:--------------|----------:|--------------:|----:|----:|------:|---------:|-----------:|
| zori_county   |         0 |          1.00 |  12 |  15 |     0 |        5 |          0 |
| date          |         0 |          1.00 |  10 |  10 |     0 |      116 |          0 |
| county        |         0 |          1.00 |   5 |   8 |     0 |        5 |          0 |
| neighborhood  |       580 |          0.97 |   7 |  29 |     0 |       42 |          0 |

**Variable type: numeric**

| skim_variable | n_missing | complete_rate | mean | sd | p0 | p25 | p50 | p75 | p100 | hist |
|:---|---:|---:|---:|---:|---:|---:|---:|---:|---:|:---|
| zip_code | 0 | 1.00 | 10738.72 | 569.92 | 10001.0 | 10044.00 | 10473.00 | 11233.00 | 11693.00 | ▇▃▁▇▅ |
| size_rank | 0 | 1.00 | 2502.44 | 3996.59 | 4.0 | 142.00 | 947.00 | 3485.00 | 30490.00 | ▇▁▁▁▁ |
| zori | 6839 | 0.61 | 2889.27 | 881.16 | 1102.4 | 2242.69 | 2702.16 | 3372.56 | 8422.62 | ▇▇▂▁▁ |

``` r
dim(zori_zip)
```

    ## [1] 17516     7

``` r
unique(zori_zip$zip_code)
```

    ##   [1] 11368 11385 11208 11236 10467 11373 11226 11207 10025 11214 11234 10314
    ##  [13] 11220 11219 11206 11221 10456 11223 11230 10458 11377 11235 11229 11233
    ##  [25] 10453 11204 10468 11355 11203 10457 10452 10469 10029 11218 11212 10462
    ##  [37] 10002 10466 11375 11691 11215 10463 11209 11213 11201 11210 11372 11432
    ##  [49] 10027 10472 11434 11211 10312 10024 10032 11216 10023 10033 11238 11435
    ##  [61] 10460 10031 11225 10128 10473 10009 11354 10306 10003 10451 10016 10461
    ##  [73] 10459 10011 11205 11237 11374 11228 10465 10040 10305 10019 11365 10028
    ##  [85] 10304 11357 10034 11217 11249 11367 10455 10021 11222 11231 10454 11378
    ##  [97] 11379 10301 11105 11364 11106 11358 10026 11418 10035 11101 11103 10022
    ## [109] 10010 10030 10014 11369 11361 11232 10308 10065 10013 11102 10075 10303
    ## [121] 10036 10001 11104 11356 10039 10038 10012 10471 11370 11426 11692 11360
    ## [133] 10037 11415 10017 10470 11693 11366 10044 10005 10007 10018 10069 10280
    ## [145] 10282 11109 10006 10162 10004

There are 17516 observations as a long form of different date and rent
index corresponding to neighborhood and zip code. The data set included
total of 149 zip codes as separate regions.

``` r
setdiff(zip_code$zip_code, zori$zip_code)
```

    ##   [1] 10464 10474 10475 10499 10550 10704 10705 10803 11202 11224 11239 11241
    ##  [13] 11242 11243 11245 11247 11251 11252 11256 10008 10020 10041 10043 10045
    ##  [25] 10047 10048 10055 10072 10080 10081 10082 10087 10101 10102 10103 10104
    ##  [37] 10105 10106 10107 10108 10109 10110 10111 10112 10113 10114 10115 10116
    ##  [49] 10117 10118 10119 10120 10121 10122 10123 10124 10125 10126 10129 10130
    ##  [61] 10131 10132 10133 10138 10149 10150 10151 10152 10153 10154 10155 10156
    ##  [73] 10157 10158 10159 10160 10161 10163 10164 10165 10166 10167 10168 10169
    ##  [85] 10170 10171 10172 10173 10174 10175 10176 10177 10178 10179 10185 10197
    ##  [97] 10199 10213 10242 10249 10256 10259 10260 10261 10265 10268 10269 10270
    ## [109] 10271 10272 10273 10274 10275 10276 10277 10278 10279 10281 10285 10286
    ## [121] 10292 11001 11004 11005 11040 11096 11351 11352 11359 11362 11363 11371
    ## [133] 11380 11381 11386 11405 11411 11412 11413 11414 11416 11417 11419 11420
    ## [145] 11421 11422 11423 11424 11425 11427 11428 11429 11430 11431 11433 11436
    ## [157] 11439 11451 11499 11559 11580 11690 11694 11695 11697 10302 10307 10309
    ## [169] 10310 10311 10313

``` r
setdiff(zip_code$county, zori$zori_county)
```

    ## [1] "Bronx"    "Kings"    "New York" "Queens"   "Richmond"

The zip codes above are not included in ZORI data with some possible
situations that:

- few or no rental listings in database
- the region is commercial or non-residential
- privacy or insufficient sampling leads to not recorded region

``` r
zori_compare <- zori_zip  |> 
  filter(date %in% c("2020_01_31", "2021_01_31"))  |> 
  pivot_wider(names_from = date, values_from = zori)  |> 
  mutate(price_change = `2020_01_31` - `2021_01_31`)  |> 
  arrange(desc(price_change)) |> 
  slice(1:10) |> 
  select(zip_code, county,zori_county, neighborhood, `2020_01_31`, `2021_01_31`, price_change,neighborhood, county,)

knitr::kable(zori_compare)
```

| zip_code | county | zori_county | neighborhood | 2020_01_31 | 2021_01_31 | price_change |
|---:|:---|:---|:---|---:|---:|---:|
| 10007 | New York | New York County | Lower Manhattan | 6334.211 | 5421.614 | 912.5966 |
| 10069 | New York | New York County | NA | 4623.042 | 3874.918 | 748.1245 |
| 10009 | New York | New York County | Lower East Side | 3406.442 | 2692.187 | 714.2550 |
| 10016 | New York | New York County | Gramercy Park and Murray Hill | 3731.135 | 3019.431 | 711.7045 |
| 10001 | New York | New York County | Chelsea and Clinton | 4108.098 | 3397.648 | 710.4499 |
| 10002 | New York | New York County | Lower East Side | 3645.416 | 2935.113 | 710.3028 |
| 10004 | New York | New York County | Lower Manhattan | 3149.658 | 2443.697 | 705.9608 |
| 10038 | New York | New York County | Lower Manhattan | 3573.201 | 2875.616 | 697.5853 |
| 10012 | New York | New York County | Greenwich Village and Soho | 3628.566 | 2942.344 | 686.2218 |
| 10010 | New York | New York County | Gramercy Park and Murray Hill | 3697.284 | 3012.353 | 684.9304 |

The dataset `zori_compare` above demonstrates the 10 zip codes that have
the greatest rental index drop during with the data recorded on date
`2020_01_31` and `2021_01_31`. Lower Manhattan seems to have multiple
neighborhoods on the list with a larger area of price dropping.The 10
areas are all in New York county with high concentrations of rental
options. The price dropping is probably due to remote working and high
living cost.
